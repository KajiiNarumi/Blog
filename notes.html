---
layout: page
title: "Asuntos"
permalink: /asuntos/
robots: noindex, nofollow
---

<h2 style="margin-bottom:2em;">Microblog del proyecto</h2>
<style>
.asunto {
  margin-bottom: 2.5em;
  padding-bottom: 2.5em;
  border-bottom: 1px solid #ececec;
}
.asunto:last-child {
  border-bottom: none;
}
.asunto-titulo {
  margin: 0.2em 0 0.5em 0;
  font-size: 1.5em;
  color: #222;
  font-weight: bold;
}
.asunto-meta {
  color: #888;
  font-size: 0.95em;
  margin-bottom: 0.6em;
}
.asunto-etiquetas {
  margin-bottom: 0.5em;
}
.asunto-etiqueta {
  display: inline-block;
  font-size: 0.85em;
  margin-right: 7px;
  background: #f5f5f5;
  color: #666;
  border-radius: 3px;
  padding: 2px 9px;
  font-weight: 500;
}
.asunto-estado-cerrado { color: #d73a4a; font-weight: bold;}
.asunto-estado-abierto { color: #28a745; font-weight: bold;}
.asunto-comentarios {margin-top:1em; font-size:0.97em;color:#444;}
.asunto-user {
  display: inline-block;
  vertical-align: middle;
  margin-right: 0.6em;
  font-size: 0.97em;
}
.asunto-user img {
  width: 28px;
  border-radius: 50%;
  vertical-align: middle;
  margin-right: 0.3em;
  box-shadow: 0 0 0 1px #eee;
}
</style>

<div id="github-issues-feed">Cargando asuntos...</div>
<div id="github-pagination" style="margin-top:2em;"></div>
<script>
const repo = "KajiiNarumi/Blog";
const perPage = 10;
let currentPage = 1;

function escapeHtml(str) {
  if(!str) return "";
  return str
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function renderLabels(labels) {
  return labels.map(label =>
    `<span class="asunto-etiqueta" style="background:#f5f5f5;color:#666;">
      ${escapeHtml(label.name)}
    </span>`
  ).join(' ');
}

function renderIssues(issues) {
  let html = "";
  if (issues.length === 0) {
    html = "<p>No hay asuntos aún.</p>";
  } else {
    issues.forEach(issue => {
      const meta = issue.milestone ? escapeHtml(issue.milestone.title) : "Sin meta";
      const estado = issue.state === "closed"
        ? '<span class="asunto-estado-cerrado">Cerrado</span>'
        : '<span class="asunto-estado-abierto">Abierto</span>';
      const labels = renderLabels(issue.labels || []);
      html += `
      <div class="asunto">
        <div class="asunto-meta">
          <span class="asunto-user">
            <img src="${issue.user.avatar_url}" alt="${issue.user.login}">
            ${escapeHtml(issue.user.login)}
          </span>
          &middot; <span>${new Date(issue.created_at).toLocaleString()}</span>
          &middot; <span>Meta: <b>${meta}</b></span>
          &middot; ${estado}
        </div>
        <div class="asunto-etiquetas">${labels}</div>
        <div class="asunto-titulo">
          <a href="${issue.html_url}" target="_blank">${escapeHtml(issue.title)}</a>
        </div>
        <div>${issue.body ? escapeHtml(issue.body).replace(/\n/g,"<br>") : ""}</div>
        <div class="asunto-comentarios" id="comments-${issue.number}">Cargando comentarios...</div>
      </div>
      `;
    });
  }
  document.getElementById('github-issues-feed').innerHTML = html;
}

function renderPagination(hasPrev, hasNext) {
  let html = "";
  if (hasPrev) {
    html += `<button onclick="loadIssues(${currentPage - 1})">&laquo; Anterior</button>`;
  }
  html += ` Página ${currentPage} `;
  if (hasNext) {
    html += `<button onclick="loadIssues(${currentPage + 1})">Siguiente &raquo;</button>`;
  }
  document.getElementById('github-pagination').innerHTML = html;
}

function loadIssues(page) {
  currentPage = page;
  document.getElementById('github-issues-feed').innerHTML = "Cargando asuntos...";
  fetch(`https://api.github.com/repos/${repo}/issues?state=open&per_page=${perPage}&page=${currentPage}`)
    .then(r => r.json())
    .then(issues => {
      renderIssues(issues);
      fetch(`https://api.github.com/repos/${repo}/issues?state=open&per_page=${perPage}&page=${currentPage + 1}`)
        .then(r => r.json())
        .then(nextIssues => {
          renderPagination(currentPage > 1, nextIssues.length > 0);
        });
      issues.forEach(issue => {
        fetch(`https://api.github.com/repos/${repo}/issues/${issue.number}/comments`)
          .then(r => r.json())
          .then(comments => {
            let html = "";
            if (comments.length === 0) {
              html = "<em>Sin comentarios.</em>";
            } else {
              html = "<ul style='list-style:none;padding:0;'>";
              comments.forEach(comment => {
                html += `
                <li style="margin-bottom:0.8em;">
                  <img src="${comment.user.avatar_url}" alt="${comment.user.login}" style="width:24px;border-radius:50%;vertical-align:middle;">
                  <strong>${escapeHtml(comment.user.login)}</strong>
                  <span style="color:#999;">${new Date(comment.created_at).toLocaleString()}</span>
                  <div>${escapeHtml(comment.body).replace(/\n/g,"<br>")}</div>
                </li>`;
              });
              html += "</ul>";
            }
            document.getElementById(`comments-${issue.number}`).innerHTML = html;
          });
      });
    });
}

window.loadIssues = loadIssues;
loadIssues(1);
</script>
